<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ø£ÙƒÙˆØ§Ø¯</title>
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;900&display=swap" rel="stylesheet">

<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:'Cairo',sans-serif;}
body{background:#0f0f12;color:white;padding:20px;}
.card{
    background:#1b1b1f;padding:20px;margin-bottom:20px;border-radius:12px;
    box-shadow:0 0 20px rgba(0,0,0,0.4);
}
input,select{
    width:100%;padding:12px;margin:7px 0;border-radius:8px;
    border:none;background:#2a2a30;color:white;font-size:16px;
}
button{
    width:100%;padding:14px;background:#4e00ff;border:none;border-radius:10px;
    color:white;font-size:18px;font-weight:bold;cursor:pointer;margin-top:10px;
}
table{
    width:100%;border-collapse:collapse;margin-top:20px;
}
th,td{
    padding:12px;border-bottom:1px solid #333;text-align:center;
}
.action-btn{
    padding:6px 10px;border:none;border-radius:6px;color:white;cursor:pointer;
}
.del{background:#e6004c;}
.copy{background:#0077ff;}
</style>
</head>
<body>

<h1 style="text-align:center;margin-bottom:20px;">ğŸ“Œ Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ø£ÙƒÙˆØ§Ø¯</h1>

<!-- ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ø£ÙƒÙˆØ§Ø¯ -->
<div class="card">
    <h2>âš¡ ØªÙˆÙ„ÙŠØ¯ Ø£ÙƒÙˆØ§Ø¯ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹</h2>

    <label>Ø¹Ø¯Ø¯ Ø§Ù„Ø£ÙƒÙˆØ§Ø¯</label>
    <input id="autoCount" type="number" placeholder="Ù…Ø«Ø§Ù„: 20">

    <label>Ù…Ø¯Ø© Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ©</label>
    <select id="autoDurationType">
        <option value="minutes">Ø¨Ø§Ù„Ø¯Ù‚Ø§Ø¦Ù‚</option>
        <option value="hours">Ø¨Ø§Ù„Ø³Ø§Ø¹Ø§Øª</option>
        <option value="days">Ø¨Ø§Ù„Ø£ÙŠØ§Ù…</option>
    </select>

    <label>Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…Ø¯Ø©</label>
    <input id="autoDurationValue" type="number" placeholder="Ù…Ø«Ø§Ù„: 60">

    <button onclick="generateAutoCodes()">âœ” ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ø£ÙƒÙˆØ§Ø¯</button>
</div>

<!-- Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø£ÙƒÙˆØ§Ø¯ -->
<div class="card">
    <h2>ğŸ“‹ Ø§Ù„Ø£ÙƒÙˆØ§Ø¯ Ø§Ù„Ø­Ø§Ù„ÙŠØ©</h2>
    <table>
        <thead>
            <tr>
                <th>Ø§Ù„ÙƒÙˆØ¯</th>
                <th>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡</th>
                <th>Ù†Ø³Ø®</th>
                <th>Ø­Ø°Ù</th>
            </tr>
        </thead>
        <tbody id="codesTable"></tbody>
    </table>
</div>

<!-- Firebase (COMPAT â€” don't change) -->
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>

<script>
// -----------------------
//  Firebase Config
// -----------------------
const firebaseConfig = {
  apiKey: "AIzaSyAdz_OsGPL5xEq-J72FCkuQezVMhU_FATo",
  authDomain: "website-83e14.firebaseapp.com",
  databaseURL: "https://website-83e14-default-rtdb.firebaseio.com",
  projectId: "website-83e14",
  storageBucket: "website-83e14.firebasestorage.app",
  messagingSenderId: "994953388464",
  appId: "1:994953388464:web:9c244de2a4fdcf8561f675",
  measurementId: "G-7PN256M5PG"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();


// ------------------------
//   ØªÙˆÙ„ÙŠØ¯ ÙƒÙˆØ¯ Ø¹Ø´ÙˆØ§Ø¦ÙŠ
// ------------------------
function generateCode() {
    const chars = "ABCDEFGHJKLMNPQRSTUVWXYZ23456789";
    let c = "";
    for (let i = 0; i < 6; i++)
        c += chars[Math.floor(Math.random() * chars.length)];
    return c;
}

// ------------------------
//   ØªÙˆÙ„ÙŠØ¯ Ø£ÙƒÙˆØ§Ø¯ ØªÙ„Ù‚Ø§Ø¦ÙŠ
// ------------------------
function generateAutoCodes() {
    const count = parseInt(document.getElementById("autoCount").value);
    const type = document.getElementById("autoDurationType").value;
    const val = parseInt(document.getElementById("autoDurationValue").value);

    if (!count || count <= 0) return alert("âŒ Ø§ÙƒØªØ¨ Ø¹Ø¯Ø¯ Ø§Ù„Ø£ÙƒÙˆØ§Ø¯");
    if (!val) return alert("âŒ Ø§ÙƒØªØ¨ Ø§Ù„Ù…Ø¯Ø©");

    for (let i = 0; i < count; i++) {
        let code = generateCode();

        let expires = Date.now();
        if (type === "minutes") expires += val * 60000;
        if (type === "hours")   expires += val * 3600000;
        if (type === "days")    expires += val * 86400000;

        db.ref("approvedCodes/" + code).set({
            expiresAt: expires,
            usedBy: "",
            deviceId: "",
            active: true,
            createdAt: Date.now()
        });
    }

    alert("âœ” ØªÙ… ØªÙˆÙ„ÙŠØ¯ " + count + " ÙƒÙˆØ¯ Ø¨Ù†Ø¬Ø§Ø­");
}

// ------------------------
//     ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£ÙƒÙˆØ§Ø¯
// ------------------------
function loadCodes() {
    const table = document.getElementById("codesTable");
    db.ref("approvedCodes").on("value", snap => {
        table.innerHTML = "";
        snap.forEach(codeSnap => {
            const code = codeSnap.key;
            const data = codeSnap.val();
            const endDate = new Date(data.expiresAt).toLocaleString();

            table.innerHTML += `
                <tr>
                    <td>${code}</td>
                    <td>${endDate}</td>
                    <td><button class="action-btn copy" onclick="copyCode('${code}')">ğŸ“‹</button></td>
                    <td><button class="action-btn del" onclick="deleteCode('${code}')">ğŸ—‘</button></td>
                </tr>
            `;
        });
    });
}

// Ù†Ø³Ø® Ø§Ù„ÙƒÙˆØ¯
function copyCode(code) {
    navigator.clipboard.writeText(code);
    alert("âœ” ØªÙ… Ù†Ø³Ø® Ø§Ù„ÙƒÙˆØ¯: " + code);
}

// Ø­Ø°Ù ÙƒÙˆØ¯
function deleteCode(code) {
    if (confirm("Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ø§Ù„ÙƒÙˆØ¯ØŸ")) {
        db.ref("approvedCodes/" + code).remove();
    }
}

loadCodes();
</script>

</body>
</html>
